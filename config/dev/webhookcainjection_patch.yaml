# Development webhook CA injection patch
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: mutating-webhook-configuration
  annotations:
    cert-manager.io/inject-ca-from: neo4j-operator-system/neo4j-operator-serving-cert
    environment: development
spec:
  webhooks:
  - name: mneo4jenterprisecluster.neo4j.com
    admissionReviewVersions:
    - v1
    - v1beta1
    clientConfig:
      service:
        name: neo4j-operator-webhook-service
        namespace: neo4j-operator-system
        path: /mutate-neo4j-neo4j-com-v1alpha1-neo4jenterprisecluster
    failurePolicy: Fail
    sideEffects: None
    timeoutSeconds: 30  # Increased timeout for development
    rules:
    - operations: ["CREATE", "UPDATE"]
      apiGroups: ["neo4j.neo4j.com"]
      apiVersions: ["v1alpha1"]
      resources: ["neo4jenterpriseclusters"]

---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: validating-webhook-configuration
  annotations:
    cert-manager.io/inject-ca-from: neo4j-operator-system/neo4j-operator-serving-cert
    environment: development
spec:
  webhooks:
  - name: vneo4jenterprisecluster.neo4j.com
    admissionReviewVersions:
    - v1
    - v1beta1
    clientConfig:
      service:
        name: neo4j-operator-webhook-service
        namespace: neo4j-operator-system
        path: /validate-neo4j-neo4j-com-v1alpha1-neo4jenterprisecluster
    failurePolicy: Fail
    sideEffects: None
    timeoutSeconds: 30  # Increased timeout for development
    rules:
    - operations: ["CREATE", "UPDATE"]
      apiGroups: ["neo4j.neo4j.com"]
      apiVersions: ["v1alpha1"]
      resources: ["neo4jenterpriseclusters"]

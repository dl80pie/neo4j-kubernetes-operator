# Development self-signed certificate issuer chain
# Creates a proper CA hierarchy for development use

# Root self-signed issuer
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: selfsigned-cluster-issuer
spec:
  selfSigned: {}

---
# Root CA certificate - must be in cert-manager namespace
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: selfsigned-ca
  namespace: cert-manager
  annotations:
    kustomize.config.k8s.io/behavior: replace
spec:
  isCA: true
  commonName: "Neo4j Operator Development CA"
  secretName: selfsigned-ca-secret
  duration: "8760h"  # 1 year
  renewBefore: "720h"  # 30 days
  subject:
    organizationalUnits:
      - "Development"
    organizations:
      - "Neo4j Kubernetes Operator"
    countries:
      - "US"
  usages:
    - cert sign
    - crl sign
    - digital signature
    - key encipherment
  issuerRef:
    name: selfsigned-cluster-issuer
    kind: ClusterIssuer

---
# CA issuer for development certificates
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: dev-ca-issuer
spec:
  ca:
    secretName: selfsigned-ca-secret

---
# Override the default issuer for webhooks in development
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: serving-cert
  namespace: neo4j-operator-system
spec:
  secretName: webhook-server-cert
  duration: "720h"  # 30 days
  renewBefore: "240h"  # 10 days
  subject:
    organizationalUnits:
      - "Development"
    organizations:
      - "Neo4j Kubernetes Operator"
  commonName: "neo4j-operator-webhook-service"
  dnsNames:
  - neo4j-operator-webhook-service
  - neo4j-operator-webhook-service.neo4j-operator-system
  - neo4j-operator-webhook-service.neo4j-operator-system.svc
  - neo4j-operator-webhook-service.neo4j-operator-system.svc.cluster.local
  usages:
  - digital signature
  - key encipherment
  - server auth
  - client auth
  issuerRef:
    name: neo4j-operator-dev-ca-issuer-fixed
    kind: ClusterIssuer
